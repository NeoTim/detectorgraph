<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DetectorGraph: examples/counterwithreset.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DetectorGraph
   &#160;<span id="projectnumber">2.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d28a4824dc47e487b107a5db32ef43c4.html">examples</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">counterwithreset.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Basic Counter with a FuturePublisher-based loop.  
<a href="#details">More...</a></p>

<p><a href="counterwithreset_8cpp_source.html">Go to the source code of this file.</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Basic Counter with a FuturePublisher-based loop. </p>
<h1><a class="anchor" id="ex-cwr-introduction"></a>
Introduction</h1>
<p>This examples cover the most basic way to close a loop in a graph - using a <a class="el" href="classDetectorGraph_1_1FuturePublisher.html" title="Publish data to the graph for future evaluation. ">DetectorGraph::FuturePublisher</a>. Unmarked loops are forbidden by the Framework as a Topographical sort is only possible in Directed Acyclic Graphs.</p>
<p>Intuitively, if there were cycles in a graph it would be impossible for the Framework to provide it's dependency guarantee: </p><blockquote class="doxtable">
<p>For any Detector, all its dependencies will be evaluated before its own evaluation. </p>
</blockquote>
<p>To construct closed loops the graph designer must explicitly define, per cycle/loop, which dependency (i.e. Topic) the above restriction will be waived.</p>
<h1><a class="anchor" id="ex-cwr-arch"></a>
Architecture</h1>
<p>The example is composed of two Detectors. The first counts <code>EventHappened</code> and the second detects the condition at which the counter should be reset.</p>
<div class="dotgraph">
<iframe scrolling="no" frameborder="0" src="dot_inline_dotgraph_2.svg" width="848" height="131"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe><div class="caption">
CounterWithReset</div>
</div>
<h1><a class="anchor" id="ex-cwr-fpvslag"></a>
FuturePublisher vs. Lag&lt;T&gt;</h1>
<p>The framework offers two ways of closing loops in a graph, <a class="el" href="classDetectorGraph_1_1FuturePublisher.html" title="Publish data to the graph for future evaluation. ">DetectorGraph::FuturePublisher</a> and <a class="el" href="classDetectorGraph_1_1Lag.html" title="Produces a Lagged&lt;T&gt; for T. ">DetectorGraph::Lag</a> - this example employs the former.</p>
<p>In this graph it is clear that the TopicState used as a graph <em>output</em> is <code>EventCount</code> and that <code>Reset</code> is produced purely for the feedback path. It is also clear to the the designer of <code>ResetDetecor</code> that the published <code>Reset</code> TopicState should be evaluated in the next Evaluation pass and not in the current one. In such cases it is reasonable to put the responsibility for closing the loop on the writer of <code>ResetDetector</code>: </p><div class="fragment"><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="keyword">class </span>ResetDetector : <span class="keyword">public</span> <a class="code" href="classDetectorGraph_1_1Detector.html">DetectorGraph::Detector</a></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;, <span class="keyword">public</span> <a class="code" href="classDetectorGraph_1_1SubscriberInterface.html">DetectorGraph::SubscriberInterface</a>&lt;EventCount&gt;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;, <span class="keyword">public</span> <a class="code" href="classDetectorGraph_1_1FuturePublisher.html">DetectorGraph::FuturePublisher</a>&lt;Reset&gt;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;{</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    ResetDetector(<a class="code" href="classDetectorGraph_1_1Graph.html">DetectorGraph::Graph</a>* graph) : <a class="code" href="namespaceDetectorGraph.html">DetectorGraph</a>::Detector(graph)</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    {</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        Subscribe&lt;EventCount&gt;(<span class="keyword">this</span>);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        SetupFuturePublishing&lt;Reset&gt;(<span class="keyword">this</span>);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classDetectorGraph_1_1SubscriberInterface.html#aa6ff973e38d74612e60d91f104daa624">Evaluate</a>(<span class="keyword">const</span> EventCount&amp; aEventCount)</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">if</span> (aEventCount.count &gt;= kMaxCount)</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        {</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            <a class="code" href="classDetectorGraph_1_1FuturePublisher.html#aa2f2c94a4ffbb2372dc707f323573eaf">PublishOnFutureEvaluation</a>(Reset());</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kMaxCount = 5;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;};</div><div class="ttc" id="classDetectorGraph_1_1Graph_html"><div class="ttname"><a href="classDetectorGraph_1_1Graph.html">DetectorGraph::Graph</a></div><div class="ttdoc">Implements a graph of Topics &amp; Detectors with Input/Output APIs. </div><div class="ttdef"><b>Definition:</b> <a href="graph_8hpp_source.html#l00127">graph.hpp:127</a></div></div>
<div class="ttc" id="classDetectorGraph_1_1FuturePublisher_html"><div class="ttname"><a href="classDetectorGraph_1_1FuturePublisher.html">DetectorGraph::FuturePublisher</a></div><div class="ttdoc">Publish data to the graph for future evaluation. </div><div class="ttdef"><b>Definition:</b> <a href="futurepublisher_8hpp_source.html#l00061">futurepublisher.hpp:61</a></div></div>
<div class="ttc" id="classDetectorGraph_1_1SubscriberInterface_html_aa6ff973e38d74612e60d91f104daa624"><div class="ttname"><a href="classDetectorGraph_1_1SubscriberInterface.html#aa6ff973e38d74612e60d91f104daa624">DetectorGraph::SubscriberInterface::Evaluate</a></div><div class="ttdeci">virtual void Evaluate(const T &amp;)=0</div><div class="ttdoc">Pure-virtual method that should Evaluate a piece of input data. </div></div>
<div class="ttc" id="classDetectorGraph_1_1Detector_html"><div class="ttname"><a href="classDetectorGraph_1_1Detector.html">DetectorGraph::Detector</a></div><div class="ttdoc">A unit of logic in a DetectorGraph. </div><div class="ttdef"><b>Definition:</b> <a href="detector_8hpp_source.html#l00068">detector.hpp:68</a></div></div>
<div class="ttc" id="classDetectorGraph_1_1SubscriberInterface_html"><div class="ttname"><a href="classDetectorGraph_1_1SubscriberInterface.html">DetectorGraph::SubscriberInterface</a></div><div class="ttdoc">A Pure interface that declares the Subscriber behavior. </div><div class="ttdef"><b>Definition:</b> <a href="subscriberinterface_8hpp_source.html#l00059">subscriberinterface.hpp:59</a></div></div>
<div class="ttc" id="namespaceDetectorGraph_html"><div class="ttname"><a href="namespaceDetectorGraph.html">DetectorGraph</a></div><div class="ttdef"><b>Definition:</b> <a href="detector_8hpp_source.html#l00028">detector.hpp:28</a></div></div>
<div class="ttc" id="classDetectorGraph_1_1FuturePublisher_html_aa2f2c94a4ffbb2372dc707f323573eaf"><div class="ttname"><a href="classDetectorGraph_1_1FuturePublisher.html#aa2f2c94a4ffbb2372dc707f323573eaf">DetectorGraph::FuturePublisher::PublishOnFutureEvaluation</a></div><div class="ttdeci">void PublishOnFutureEvaluation(const T &amp;aData)</div><div class="ttdoc">Publish a new version of T to the Graph for future evaluation. </div><div class="ttdef"><b>Definition:</b> <a href="futurepublisher_8hpp_source.html#l00077">futurepublisher.hpp:77</a></div></div>
</div><!-- fragment --><p> In cases where downstream parts of the graph also subscribe to the TopicState used in the feedback loop, <a class="el" href="classDetectorGraph_1_1Lag.html" title="Produces a Lagged&lt;T&gt; for T. ">DetectorGraph::Lag</a> should be used instead. For more info on that see other <a class="el" href="custom_examples.html#feedback-loops">Feedback Loop examples</a> (e.g. <a class="el" href="robotlocalization_8cpp.html">Robot Localization</a>)</p>
<h1><a class="anchor" id="ex-cwr-graph"></a>
Graph</h1>
<p>The graph instantiated and evaluation code is unaffected. Both </p><div class="fragment"><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="keyword">class </span>CounterWithResetGraph : <span class="keyword">public</span> <a class="code" href="classDetectorGraph_1_1ProcessorContainer.html">DetectorGraph::ProcessorContainer</a></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;{</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    CounterWithResetGraph()</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    : mEventCountDetector(&amp;mGraph)</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    , mResetDetector(&amp;mGraph)</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    , mEventCountTopic(mGraph.ResolveTopic&lt;EventCount&gt;())</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    {</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    EventCountDetector mEventCountDetector;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    ResetDetector mResetDetector;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <a class="code" href="classDetectorGraph_1_1Topic.html">DetectorGraph::Topic&lt;EventCount&gt;</a>* mEventCountTopic;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classDetectorGraph_1_1ProcessorContainer.html#a8f3cf10565478b9842e2089f2d81494f">ProcessOutput</a>()</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="keywordflow">if</span> (mEventCountTopic-&gt;<a class="code" href="classDetectorGraph_1_1Topic.html#a6074b31ae076b626be2c04f819a6f41f">HasNewValue</a>())</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            <span class="keyword">const</span> EventCount&amp; eventCount = mEventCountTopic-&gt;<a class="code" href="classDetectorGraph_1_1Topic.html#a3acc3d38431047d1ca7e09f37c84a7b6">GetNewValue</a>();</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            cout &lt;&lt; <span class="stringliteral">&quot;EventCount.count = &quot;</span> &lt;&lt; eventCount.count &lt;&lt; endl;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    }</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;};</div><div class="ttc" id="classDetectorGraph_1_1Topic_html_a6074b31ae076b626be2c04f819a6f41f"><div class="ttname"><a href="classDetectorGraph_1_1Topic.html#a6074b31ae076b626be2c04f819a6f41f">DetectorGraph::Topic::HasNewValue</a></div><div class="ttdeci">bool HasNewValue() const</div><div class="ttdoc">Returns true if the new Data is available. </div><div class="ttdef"><b>Definition:</b> <a href="topic_8hpp_source.html#l00166">topic.hpp:166</a></div></div>
<div class="ttc" id="classDetectorGraph_1_1ProcessorContainer_html"><div class="ttname"><a href="classDetectorGraph_1_1ProcessorContainer.html">DetectorGraph::ProcessorContainer</a></div><div class="ttdoc">A Base class for a basic Graph container. </div><div class="ttdef"><b>Definition:</b> <a href="processorcontainer_8hpp_source.html#l00036">processorcontainer.hpp:36</a></div></div>
<div class="ttc" id="classDetectorGraph_1_1Topic_html"><div class="ttname"><a href="classDetectorGraph_1_1Topic.html">DetectorGraph::Topic</a></div><div class="ttdoc">Manage data and its handler. </div><div class="ttdef"><b>Definition:</b> <a href="topic_8hpp_source.html#l00084">topic.hpp:84</a></div></div>
<div class="ttc" id="classDetectorGraph_1_1ProcessorContainer_html_a8f3cf10565478b9842e2089f2d81494f"><div class="ttname"><a href="classDetectorGraph_1_1ProcessorContainer.html#a8f3cf10565478b9842e2089f2d81494f">DetectorGraph::ProcessorContainer::ProcessOutput</a></div><div class="ttdeci">virtual void ProcessOutput()=0</div><div class="ttdoc">Called after each Graph Evaluation. </div></div>
<div class="ttc" id="classDetectorGraph_1_1Topic_html_a3acc3d38431047d1ca7e09f37c84a7b6"><div class="ttname"><a href="classDetectorGraph_1_1Topic.html#a3acc3d38431047d1ca7e09f37c84a7b6">DetectorGraph::Topic::GetNewValue</a></div><div class="ttdeci">const T &amp; GetNewValue() const</div><div class="ttdoc">Returns reference to the new/latest value in the topic. </div><div class="ttdef"><b>Definition:</b> <a href="topic_8hpp_source.html#l00179">topic.hpp:179</a></div></div>
</div><!-- fragment --><p> and </p><div class="fragment"><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="keywordtype">int</span> main()</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;{</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    CounterWithResetGraph counterGraph;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 7; ++i)</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        counterGraph.ProcessData(EventHappened());</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    }</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;}</div></div><!-- fragment --><p> work in the same way as with simple graphs.</p>
<p>Running the program produces: </p><pre class="fragment">DetectorGraph: Graph Initialized
EventCount.count = 1
EventCount.count = 2
EventCount.count = 3
EventCount.count = 4
EventCount.count = 5
EventCount.count = 0
EventCount.count = 1
EventCount.count = 2</pre><p>One important thing to note in this case is that ProcessOutput is called 8 times even though <code>main</code> only pushes 7 TopicStates into the graph - this is by design and allows all graph outputs to continue to be inspected exactly once per-evaluation. This is the case for all graphs with closed loops. </p>

<p class="definition">Definition in file <a class="el" href="counterwithreset_8cpp_source.html">counterwithreset.cpp</a>.</p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
