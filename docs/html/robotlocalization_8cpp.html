<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DetectorGraph: examples/robotlocalization.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DetectorGraph
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d28a4824dc47e487b107a5db32ef43c4.html">examples</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">robotlocalization.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A localization system for a mobile robot with Lag-based feedback loop.  
<a href="#details">More...</a></p>

<p><a href="robotlocalization_8cpp_source.html">Go to the source code of this file.</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A localization system for a mobile robot with Lag-based feedback loop. </p>
<h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p>Back in the 2000s all [<em>citation needed</em>] robots were <em>differential wheeled robots</em> [1] and localization with sensor fusion was a popular problem. This example shows a simple solution to that problem using <a class="el" href="namespaceDetectorGraph.html">DetectorGraph</a>. It uses an Extended Kalman Filter [2] to continuously predict and correct the robot's Pose (and associated uncertainty) from two information sources: the input to the wheels and a GPS-like system.</p>
<h1><a class="anchor" id="fpvslag"></a>
FuturePublisher vs. Lag&lt;T&gt;</h1>
<p>This localization algorithm depends on a feedback-loop in that the output of one graph evaluation (i.e. <code>LocalizationBelief</code>) is used as an input for the next one (i.e. <code>Lagged&lt;LocalizationBelief&gt;</code>): </p><div class="fragment"><div class="line"><span class="keyword">class </span>KalmanPoseCorrector : <span class="keyword">public</span> Detector,</div><div class="line">    <span class="keyword">public</span> SubscriberInterface&lt; Lagged&lt;LocalizationBelief&gt; &gt;,</div><div class="line">    <span class="keyword">public</span> SubscriberInterface&lt;GPSPosition&gt;,</div><div class="line">    <span class="keyword">public</span> Publisher&lt;LocalizationBelief&gt;</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    KalmanPoseCorrector(Graph* graph) : Detector(graph), mCurrentBelief()</div><div class="line">    {</div><div class="line">        Subscribe&lt; Lagged&lt;LocalizationBelief&gt; &gt;(<span class="keyword">this</span>);</div><div class="line">        Subscribe&lt;GPSPosition&gt;(<span class="keyword">this</span>);</div><div class="line">        SetupPublishing&lt;LocalizationBelief&gt;(<span class="keyword">this</span>);</div><div class="line">    }</div></div><!-- fragment --><p> Note that in this graph the TopicState where the feedback loop closes is a legitimate output in itself and it's very likely that new Detectors in the graph would subscribe to it. In cases like this the use of <a class="el" href="classDetectorGraph_1_1Lag.html" title="Produces a Lagged&lt;T&gt; for T. ">DetectorGraph::Lag</a> is preferred as it is more extensible and it preserves the normal TopicState guarantee for the TopicState in question as well as it makes the Lagged version of the TopicState clearly documented and also available. Lag allows even for detectors that subscribes to both the immediate and the Lagged version of a TopicState - this could be useful for things like differentiation etc.</p>
<h1><a class="anchor" id="ssc"></a>
Configuration TopicStates</h1>
<p>It also shows how TopicStates can be used for static/configuration data (e.g. <code>RobotConfig</code>). This allows for easy dependency tracking, visualization and testing at pretty much no runtime cost.</p>
<h1><a class="anchor" id="la"></a>
Localization Algorithm</h1>
<p>Regarding the Localization algorithm itself, it's mostly taken from [3] except for the correction model where this example uses a different input (i.e. <code>GPSPosition</code>) with much simpler transfer function to the Pose vector.</p>
<h1><a class="anchor" id="Architecture"></a>
Architecture</h1>
<p>The graph below shows the relationships between the topics (rectangles) and detectors (ellipses). Note that this graph can be automatically generated for any instance of <a class="el" href="classDetectorGraph_1_1Graph.html" title="Implements a graph of Topics &amp; Detectors with Input/Output APIs. ">DetectorGraph::Graph</a> using DetectorGraph::GraphAnalyzer. </p><div class="dotgraph">
<iframe scrolling="no" frameborder="0" src="dot_inline_dotgraph_6.svg" width="1152" height="314"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe><div class="caption">
RobotBrain</div>
</div>
<h1><a class="anchor" id="on"></a>
Other Notes</h1>
<p>This example also uses the Eigen library [4] for matrix/vector arithmetic and linear-algebraic operations.</p>
<p>Note that this entire algorithm is contained in a single file for the sake of unity as an example. In real-world scenarios the suggested pattern is to split the code into:</p>
<pre class="fragment">   detectorgraph/
        include/
            robotbrain.hpp (RobotBrain header)
        src/
            robotbrain.hpp (RobotBrain implementation)
        detectors/
            include/
                ExtendedKalmanPosePredictor.hpp
                KalmanPoseCorrector.hpp
            src/
                ExtendedKalmanPosePredictor.cpp
                KalmanPoseCorrector.cpp
        topicstates/
            include/
                RobotConfig.hpp
                InitialPose.hpp
                WheelSpeeds.hpp
                LocalizationBelief.hpp
                GPSPosition.hpp
</pre><h1><a class="anchor" id="References"></a>
References</h1>
<ul>
<li>[1] Differential Wheeled Robots - <a href="https://en.wikipedia.org/wiki/Differential_wheeled_robot">https://en.wikipedia.org/wiki/Differential_wheeled_robot</a></li>
<li>[2] Extended Kalman Filter - <a href="https://en.wikipedia.org/wiki/Extended_Kalman_filter">https://en.wikipedia.org/wiki/Extended_Kalman_filter</a></li>
<li>[3] EKF applied to Mobile Robotâ€™s Localization (Section 2.4.4, page 17) - <a href="http://cpscotti.com/pdf/pfc_scotti.pdf">http://cpscotti.com/pdf/pfc_scotti.pdf</a></li>
<li>[4] Eigen - <a href="http://eigen.tuxfamily.org/dox/index.html">http://eigen.tuxfamily.org/dox/index.html</a> </li>
</ul>

<p class="definition">Definition in file <a class="el" href="robotlocalization_8cpp_source.html">robotlocalization.cpp</a>.</p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
